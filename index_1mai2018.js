

var mindato = function( dateObj) { 

	var monthNames = [
			"jan", "feb", "mar",
			"apr", "mai", "juni", "juli",
			"aug", "sep", "okt",
			"nov", "des"
		];

		
	var datostreng = dateObj.getDate() + ". " 
						+ monthNames[dateObj.getMonth()] + " " 
						+  dateObj.getFullYear();

	var helTime = ('0'+dateObj.getHours()).slice(-2);
	var minutt = ('0'+dateObj.getMinutes()).slice(-2);
	var sekund = ('0'+dateObj.getSeconds()).slice(-2);

	var klokkestreng = helTime + ':' + minutt + ':' + sekund; 

	return { dato: datostreng, klokke: klokkestreng }; 

}



var map = new L.map('map').setView([63.43, 10.40], 14);


L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

function onLocationFound(e) {
	var radius = e.accuracy / 2;

	L.marker(e.latlng).addTo(map)
		.bindPopup("Du er her!");

	L.circle(e.latlng, radius).addTo(map)
		.bindPopup("Usikkerhet");
}

function onLocationError(e) {
	alert(e.message);
}

map.on('locationfound', onLocationFound);
map.on('locationerror', onLocationError);

/*
map.locate({setView: true, maxZoom: 13}); 
*/

realtime = L.realtime({
        url: 'https://jansimple.pythonanywhere.com/getfile/SSMfane.geojson',
        // url: 'https://jansimple.pythonanywhere.com/getfile/Jan.geojson',
        crossOrigin: true,
        type: 'json'
    },
	{
        interval: 30 * 1000, 
		pointToLayer: function (feature, latlng) {
			return L.marker(latlng, {
				'icon': L.icon({
					iconUrl: 'img/1431044506_circle_red36x36.png',
					iconSize:     [36, 36], // size of the icon
					iconAnchor: [18, 18], 
					popupAnchor:  [0, -50] // point from which the popup should open relative to the iconAnchor
				})
			});
		}
	}).addTo(map); // KOMMENTER INN



realtimeLinje = L.realtime({
        url: 'https://jansimple.pythonanywhere.com/getfile/SSMfane_kurve.geojson',
        // url: 'https://jansimple.pythonanywhere.com/getfile/Jan_kurve.geojson',
        crossOrigin: true,
        type: 'json'
    },
	{
        interval: 30 * 1000
    }).addTo(map); // KOMMENTER INN

var firstTimeLinje = true; 


	
realtimeLinje.on('update', function(e) {

	if (firstTimeLinje) {
	   popupContent = function(fId) {
				return 'Spor etter SSM fana'; 
			},
		bindFeaturePopup = function(fId) {
			realtimeLinje.getLayer(fId).bindPopup(popupContent(fId));
		},
		updateFeaturePopup = function(fId) {
            realtime.getLayer(fId).getPopup().setContent(popupContent(fId));
        };

		Object.keys(e.enter).forEach(bindFeaturePopup);
		Object.keys(e.update).forEach(updateFeaturePopup);
	}
	
	firstTimeLinje = false; 

});

// 1. mai punkt 
var punkt = {"type": "FeatureCollection",
"features": [{ "type": "Feature", 
"properties": { "description": "Vi spiller  på Persaunet Helse- og Velferdssenter ca kl 10:00. Etterpå serverer de saft.", 
"name": "Persaunet Helse- og Velferdssenter" }, "geometry": { "type": "Point", "coordinates": [ 10.438772163518735, 63.428913977547886 ] } }, 

{"type":"Feature","geometry":{"type":"Point","coordinates":[10.455251,63.433514]},"properties":{"name":"Strindheim&nbsp;skole","description":"09:00 Oppmøte og avmarsj. Tilbake ca 11.00, uniformsinspeksjon, medalje- og stjernedryss og KAKER i festsalen"}}



]};


/* Gamle 17. mai punkt 
{"type":"Feature","geometry":{"type":"Point","coordinates":[10.455691,63.428077]},"properties":{"name":"Bromstad&nbsp;h&vf.sent.","description":"Vi stopper på Bromstad Helse- og velferdssenter  for å spille litt"}},

{"type":"Feature","geometry":{"type":"Point","coordinates":[10.444608,63.4244]},"properties":{"name":"Valentinlyst&nbsp;16:00","description":"16:00 - oppmøte ALLE, P-plass ved Valentinlyst sykehjem. "}},

*/

// 17. mai punkt 2017
/*
 var punkt = {"type": "FeatureCollection", "features": [
 {"type":"Feature","geometry":{"type":"Point","coordinates":[10.455691,63.428077]},"properties":{"name":"Bromstad&nbsp;h&vf.sent.","description":"Vi stopper på Bromstad Helse- og velferdssenter  for å spille litt."}},

	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.455251,63.433514]},"properties":{"name":"Strindheim&nbsp;skole","description":"06:45 Frokost<br>\n08:00 Flaggheis, taler, allsang, korpsmusikk, avmarsj mot sentrum (4-7 trinn)<br>\n<em>Ettermiddag:</em><br>\nCa 17:00 korpset ankommer, festen begynner"}},
	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.41294,63.43262]},"properties":{"name":"Thornæsparken 09:15","description":"Korpset marsjerer hit fra skolen (4. trinn og oppover). 2. og 3. trinn møter senest 09:15."}},
	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.398731,63.427857]},"properties":{"name":"Bispegata","description":"Korpset marsjerer hit for å slutte seg til resten av barnetoget. Avmarsj 10:11"}},
	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.441668,63.425029]},"properties":{"name":"Valentinlyst&nbsp;06:30","description":"HK møter 06:30 på parkeringsplassen Valentinlyst, mot kirka. "}},
	{ "type": "Feature", "properties": { "description": "Persaunet Helse- og Velferdssenter. Vi spiller her kl 16:00, så marsjerer vi til skolen via Bromstad H&Vf.", "name": "Persaunet H&Vf.sent. 16:00" }, "geometry": { "type": "Point", "coordinates": [ 10.438772163518735, 63.428913977547886 ] } }

	]} 
*/

/*
var henteomraade = {"type": "FeatureCollection", "features": [
	{"type":"Feature","geometry":{"type":"MultiPolygon","coordinates":[[[[10.40004,63.428514],[10.400142,63.428422],[10.400335,63.428437],[10.400442,63.428528],[10.400534,63.428691],[10.400909,63.429183],[10.401328,63.429656],[10.401607,63.430025],[10.401843,63.430496],[10.402519,63.431311],[10.402958,63.431791],[10.403205,63.43217],[10.403452,63.432588],[10.403624,63.432832],[10.403699,63.433015],[10.403398,63.432991],[10.403205,63.432856],[10.403044,63.432477],[10.402604,63.431945],[10.402014,63.431249],[10.401392,63.430553],[10.400952,63.429934],[10.400641,63.429445],[10.400426,63.429065],[10.400228,63.428806],[10.40004,63.428514]]]]},"properties":{"cartodb_id":1,"name":"Henteområde","description":"Sånn cirka i dette området går toget i oppløsning -- det er her du må plukke opp ungene dine!","created_at":"2015-04-29T22:01:42Z","updated_at":"2015-04-29T22:12:28Z"}}]}; 
*/
	
	
// Marsjruter 1. mai
// var marsjgeo = {"type": "FeatureCollection",
// "features": [{ "type": "Feature", "properties": { "description": "Marsrute 1. Mai. Vi spiller og pauser på Persaunet Helse- og Velferdssenter", "name": "Marsjrute 1. Mai" }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.454849651765914, 63.43347910933781 ], [ 10.455133849727513, 63.433901568279303 ], [ 10.455439230583663, 63.434682332235496 ], [ 10.454170047384643, 63.43490525813835 ], [ 10.454746, 63.43527 ], [ 10.454864, 63.435368 ], [ 10.454966, 63.435445 ], [ 10.453094, 63.435683 ], [ 10.451244, 63.435901 ], [ 10.450621, 63.435954 ], [ 10.449414, 63.436028 ], [ 10.449092, 63.435145 ], [ 10.448738, 63.43421 ], [ 10.448492, 63.433576 ], [ 10.448481, 63.433495 ], [ 10.44862, 63.433327 ], [ 10.44714, 63.432813 ], [ 10.446464, 63.433178 ], [ 10.444576, 63.432549 ], [ 10.443803, 63.433125 ], [ 10.441609129136143, 63.432619738170764 ], [ 10.440686387039305, 63.432161214816539 ], [ 10.440021094111204, 63.431903882028401 ], [ 10.439544, 63.431436 ], [ 10.439225924269126, 63.431063884367184 ], [ 10.439317397668015, 63.430955060205484 ], [ 10.438856420929257, 63.430789641372897 ], [ 10.438430192462119, 63.430587525387466 ], [ 10.438128, 63.430328 ], [ 10.437849, 63.430064 ], [ 10.437707186590458, 63.429828613313511 ], [ 10.437537, 63.429622 ], [ 10.437312, 63.429459 ], [ 10.437001, 63.429291 ], [ 10.436282, 63.429075 ], [ 10.435809704251394, 63.42894887576449 ], [ 10.435870157505946, 63.428788572039785 ], [ 10.435832, 63.428398 ], [ 10.436035, 63.42811 ], [ 10.436281431753009, 63.427957264241819 ], [ 10.438559148198154, 63.428197514763625 ], [ 10.440833605695945, 63.428406921773011 ], [ 10.441413020912364, 63.429207466003945 ], [ 10.442261652792947, 63.429463689767545 ], [ 10.44375087662563, 63.429721851640501 ], [ 10.444954801339669, 63.430295942568875 ], [ 10.445858898591952, 63.430628939077891 ], [ 10.447560797247812, 63.430972829440925 ], [ 10.448591065191625, 63.431446638652353 ], [ 10.448998359790195, 63.431584135088805 ], [ 10.449146053371603, 63.431583353647476 ], [ 10.449316883270939, 63.431633320731223 ], [ 10.44935347343182, 63.431705638416176 ], [ 10.44957160634795, 63.431915680633374 ], [ 10.450559047449342, 63.432925459620705 ], [ 10.450176110214342, 63.433692520496514 ], [ 10.451447533963657, 63.433980901725398 ], [ 10.452854603852995, 63.434398518023848 ], [ 10.453595456226443, 63.434607035986218 ], [ 10.454096431184125, 63.434266960432318 ], [ 10.454715160626318, 63.433923205786215 ], [ 10.454765196809836, 63.433509668059024 ] ] ] } }]};





// Marsjruter for 17. mai - 2017
/*
var marsjgeo = {
"type": "FeatureCollection",
"features": [
{ "type": "Feature", "properties": { "name": "Marsjrute em 17. Mai", "description": "Marsrute ettermiddag 17. Mai. Vi starter med spilling på Persaunet Helse- og Velferdssenter, dernest til Bromstad Helse- og Velferdssenter før vi marsjerer til skolegårdsfest"  }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.438912857896044, 63.428831562027945 ], [ 10.43947248494503, 63.428734293689431 ], [ 10.439665410412415, 63.428553474159727 ], [ 10.439890019127427, 63.428514263439851 ], [ 10.44023339909962, 63.428487598315954 ], [ 10.440148860222775, 63.4283653561777 ], [ 10.440821344257429, 63.428421723692402 ], [ 10.441224408118817, 63.4284139804898 ], [ 10.442876720024756, 63.428122772140597 ], [ 10.443665132797031, 63.427966427359308 ], [ 10.444564109819229, 63.428359578677863 ], [ 10.445690911608908, 63.428778612336771 ], [ 10.447159732928725, 63.42916805505029 ], [ 10.448473417425735, 63.429475166718191 ], [ 10.450027960247519, 63.429813868092552 ], [ 10.450936164682625, 63.429992033598637 ], [ 10.451045604336695, 63.429939418463412 ], [ 10.45116705967056, 63.42992096449683 ], [ 10.451300691088033, 63.429912427128201 ], [ 10.451406378575951, 63.429932938376538 ], [ 10.451467095730818, 63.429867407486917 ], [ 10.45171221732118, 63.429763203294449 ], [ 10.452327932078934, 63.429614451673501 ], [ 10.452431114433725, 63.429600867039838 ], [ 10.452905412500629, 63.429458289030059 ], [ 10.453353422079198, 63.429308498554761 ], [ 10.453677932596008, 63.429199424538581 ], [ 10.454482525475987, 63.428975188357185 ], [ 10.454992724349049, 63.428801653143886 ], [ 10.45514667090084, 63.428747623793299 ], [ 10.454849092834152, 63.428296344478738 ], [ 10.455368581732664, 63.428211172269954 ], [ 10.454929127090107, 63.428325862861122 ], [ 10.455200182385857, 63.428729163327077 ], [ 10.455363294356429, 63.428796148097724 ], [ 10.454943365557559, 63.428913241745541 ], [ 10.454705252698014, 63.429014265345778 ], [ 10.454450712202965, 63.429183634201124 ], [ 10.454380769638195, 63.42932721821861 ], [ 10.454350560901851, 63.429471102142237 ], [ 10.454493638342212, 63.429876921800115 ], [ 10.45455441229022, 63.430059958448922 ], [ 10.454625315229586, 63.430069019638765 ], [ 10.454698243967208, 63.430075362468671 ], [ 10.454767121108294, 63.430094390955148 ], [ 10.454803170562846, 63.430124644938999 ], [ 10.454806915609684, 63.430169562457039 ], [ 10.454791865985451, 63.430203634721067 ], [ 10.45472448349491, 63.430240146558525 ], [ 10.454629474433103, 63.430250595533771 ], [ 10.454530589242156, 63.430242342198014 ], [ 10.454470223792807, 63.430220550578071 ], [ 10.453974443569866, 63.430245118892643 ], [ 10.453169559163923, 63.430289168941925 ], [ 10.452579723980589, 63.430279404542411 ], [ 10.452001521525236, 63.430233133696042 ], [ 10.451613462025396, 63.430186467385205 ], [ 10.451515107012453, 63.430178958952332 ], [ 10.451446204596815, 63.430209453650889 ], [ 10.451351452562651, 63.430231471875487 ], [ 10.45135145256266, 63.430231471875487 ], [ 10.451254459595621, 63.430236792433988 ], [ 10.451151438603775, 63.430233277393967 ], [ 10.45105005422864, 63.430217563618456 ], [ 10.450970587500017, 63.430182227457628 ], [ 10.450970587500008, 63.430182227457642 ], [ 10.450874450135876, 63.430202144386278 ], [ 10.45067527160327, 63.430267598085834 ], [ 10.450412134239139, 63.430411291556283 ], [ 10.45009603804349, 63.430537045210471 ], [ 10.449977051630446, 63.430659631516662 ], [ 10.449895366576097, 63.430766087173197 ], [ 10.449684064945664, 63.430984098804565 ], [ 10.449566377547901, 63.431234072834691 ], [ 10.449501428193081, 63.431340859782907 ], [ 10.449371089776164, 63.431462387896104 ], [ 10.449312229076099, 63.431611683248356 ], [ 10.449340667391315, 63.431714227390579 ], [ 10.449551064538054, 63.431873110178508 ], [ 10.449975184319335, 63.432321643767118 ], [ 10.450088873097839, 63.432472199394319 ], [ 10.450611393750011, 63.432979242110321 ], [ 10.450277996195659, 63.433719177038391 ], [ 10.451492544836968, 63.434024809547473 ], [ 10.452098576188869, 63.434178938726639 ], [ 10.452413792663044, 63.434273516681088 ], [ 10.452562053396743, 63.434323265253454 ], [ 10.452959589814489, 63.434410258376282 ], [ 10.453065642663043, 63.434425228350662 ], [ 10.453349563177941, 63.434494566581854 ], [ 10.45358757237457, 63.434575527799218 ], [ 10.454096058593773, 63.434280987281639 ], [ 10.454734470006825, 63.433912392412473 ], [ 10.455067958831521, 63.433593913763126 ] ] ] } },
{ "type": "Feature", "properties": { "name": "SSM marsj formiddag", "description": "Marsjrute om formiddagen 17. Mai fra skolen til Thornæsparken." }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.455162082201088, 63.43361140563789 ], [ 10.454835205298913, 63.433918525651244 ], [ 10.455292781249998, 63.434252789247914 ], [ 10.455438384239125, 63.434590792528226 ], [ 10.455333439402169, 63.434700340333109 ], [ 10.454229698641305, 63.434880958679827 ], [ 10.454386, 63.435006 ], [ 10.454388, 63.435012 ], [ 10.454676479483695, 63.435220716177803 ], [ 10.454960698641303, 63.435437783004076 ], [ 10.454890712771739, 63.435463284642687 ], [ 10.454036, 63.435568 ], [ 10.453823, 63.435598 ], [ 10.453456534239129, 63.435639129129264 ], [ 10.453040979076125, 63.43569228149218 ], [ 10.452661, 63.435736 ], [ 10.451775616440218, 63.435841639432311 ], [ 10.451255445448368, 63.435903653063058 ], [ 10.450551650747281, 63.435957108876345 ], [ 10.45012765074728, 63.435980108876343 ], [ 10.449454684918475, 63.436021639452747 ], [ 10.448550540964673, 63.436092360489795 ], [ 10.448112383559783, 63.436122809583637 ], [ 10.447426, 63.436183 ], [ 10.446192835597827, 63.436300244921384 ], [ 10.445601767119568, 63.436353149749308 ], [ 10.444832075339674, 63.436420884551289 ], [ 10.443868, 63.436502 ], [ 10.443567616440216, 63.436527925108209 ], [ 10.443212198734889, 63.436558115883251 ], [ 10.442584, 63.43664 ], [ 10.442236232880434, 63.43669851010862 ], [ 10.441801541100544, 63.436764605218883 ], [ 10.440854411005434, 63.436914714715549 ], [ 10.440671757948436, 63.436972902439997 ], [ 10.440288, 63.43705 ], [ 10.440038579415818, 63.437102482411291 ], [ 10.439778, 63.43712 ], [ 10.439409418517151, 63.437139519930589 ], [ 10.439024335258154, 63.437148380254229 ], [ 10.438859, 63.437142 ], [ 10.43858, 63.437131 ], [ 10.437983863043479, 63.437101809863464 ], [ 10.43772284932065, 63.437056939620547 ], [ 10.437622239741847, 63.437006564870977 ], [ 10.43745, 63.436917 ], [ 10.43725, 63.436817 ], [ 10.437068, 63.436722 ], [ 10.436896698641302, 63.436622809726252 ], [ 10.436767952105978, 63.436551360339074 ], [ 10.436411746535327, 63.436447714514443 ], [ 10.436288815149457, 63.436422890814761 ], [ 10.435734657472826, 63.43636441497511 ], [ 10.43526590407609, 63.436314979689932 ], [ 10.435021828736414, 63.436353380709448 ], [ 10.43474, 63.436337 ], [ 10.433789, 63.436284 ], [ 10.433247, 63.436258 ], [ 10.432197, 63.4362 ], [ 10.431383356249999, 63.436156639535156 ], [ 10.431205301494565, 63.436156408444035 ], [ 10.430869541100545, 63.436182 ], [ 10.430651780842389, 63.436057074844122 ], [ 10.430337335529892, 63.435907591866368 ], [ 10.430259520516303, 63.435926374158214 ], [ 10.430047815013589, 63.435993136013067 ], [ 10.429514924524458, 63.43604997962484 ], [ 10.428379157540761, 63.435998061174082 ], [ 10.427335650611413, 63.435948251685055 ], [ 10.425435978872287, 63.435855639437264 ], [ 10.425359287635867, 63.435693387480818 ], [ 10.424700541372282, 63.43560855838971 ], [ 10.424185212432064, 63.4355527418356 ], [ 10.423957630163043, 63.435519197850738 ], [ 10.424046102785329, 63.43492693021895 ], [ 10.422148, 63.434912 ], [ 10.422022, 63.434916 ], [ 10.421816794565217, 63.434942605702169 ], [ 10.421620931521739, 63.43492309538113 ], [ 10.42136522601902, 63.434921286144288 ], [ 10.421156527377716, 63.434918721748474 ], [ 10.420935630163042, 63.434900394288924 ], [ 10.420421, 63.434914 ], [ 10.419522602717393, 63.434943523118982 ], [ 10.417518369836957, 63.434073459940556 ], [ 10.416533904076086, 63.434549414938012 ], [ 10.415153794429349, 63.433980492697188 ], [ 10.413402554823371, 63.433261053500772 ], [ 10.412273219157608, 63.432834340388482 ] ] ] } },
{ "type": "Feature", "properties": { "name": "SSM marsj formiddag #2", "description": "Marsjrute formiddag 17. Mai fra Thornæsparken til Bispegata" }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.412237339028533, 63.432817994497981 ], [ 10.411985821875001, 63.432714492135503 ], [ 10.411041787567934, 63.432356499993617 ], [ 10.410399068478261, 63.432092776684087 ], [ 10.409952856453801, 63.431892247899128 ], [ 10.409242570637604, 63.431612646089604 ], [ 10.408641296807192, 63.431347528278941 ], [ 10.407725493206524, 63.430957129781341 ], [ 10.407255602717392, 63.430766340556914 ], [ 10.407141588994566, 63.430666318869527 ], [ 10.406982260190217, 63.430574615993173 ], [ 10.40685906847826, 63.430431807956609 ], [ 10.406742506793481, 63.430336402024743 ], [ 10.406008383559781, 63.430341720855075 ], [ 10.405925643885872, 63.430291681192131 ], [ 10.40539839728261, 63.429992489069569 ], [ 10.404924424728261, 63.429762236079917 ], [ 10.404128657744565, 63.42946622575343 ], [ 10.403970296909099, 63.429465696885863 ], [ 10.403752759071049, 63.429189615642734 ], [ 10.403495626286878, 63.428976172761793 ], [ 10.403362820620645, 63.428891913761795 ], [ 10.403191616440216, 63.428755095735646 ], [ 10.402953, 63.428072 ], [ 10.400567547282607, 63.428328311938756 ], [ 10.400098095923914, 63.428408259384284 ], [ 10.399997, 63.428329845354114 ], [ 10.399883931521739, 63.428005793330655 ], [ 10.399791767255435, 63.42793964540197 ], [ 10.399689675547341, 63.427918122348984 ], [ 10.398825150679349, 63.427863363177551 ] ] ] } },
{ "type": "Feature", "properties": { "name": "Barnetog sentrum",  "description": "Marsjrute barnetog i sentrum. Bispegt – Munkegt – Olav Trygvassons gt - Nordre gt - Kongens gt – Kjøpmanns gate " }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.398722616440217, 63.42785536318118 ], [ 10.396566616440214, 63.427705295969702 ], [ 10.395119027445652, 63.430361354784111 ], [ 10.395225010019406, 63.430397461044947 ], [ 10.395328121343297, 63.430467240043392 ], [ 10.395292394383622, 63.430575437009161 ], [ 10.395142079381605, 63.430638906701262 ], [ 10.394960835471215, 63.430719457970476 ], [ 10.394330191847827, 63.431867721931937 ], [ 10.39423832572632, 63.431966417878826 ], [ 10.393579260326085, 63.433172426226029 ], [ 10.395759, 63.433227128044187 ], [ 10.397322780842392, 63.433257298235119 ], [ 10.397403082201087, 63.432698915225217 ], [ 10.397528328804347, 63.431941127466118 ], [ 10.397692547961956, 63.430941637831985 ], [ 10.39776606847826, 63.430394681175216 ], [ 10.399270150679351, 63.430343213849874 ], [ 10.40006468491848, 63.430315659406148 ], [ 10.401462643885871, 63.430264192094413 ] ] ] } },
{ "type": "Feature", "id": 0, "properties": { "name": "SSM marsj morgen", "description": "SSM marsjrute morgen 17.Mai" }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.441114076721204, 63.424792778143733 ], [ 10.441302308454619, 63.425218271830232 ], [ 10.44314498837052, 63.425117751349298 ], [ 10.445792089264611, 63.426298597485292 ], [ 10.446501095385123, 63.426601994353788 ], [ 10.446866544324834, 63.426439621548731 ], [ 10.447252555777141, 63.426636954581809 ], [ 10.448000878110435, 63.426962915177434 ], [ 10.448000878110435, 63.426962915177434 ], [ 10.448616720783704, 63.427238403927149 ], [ 10.44886913145937, 63.42735949429612 ], [ 10.44918047486528, 63.42751275288326 ], [ 10.449252435534001, 63.427932077806737 ], [ 10.449333476575161, 63.42800515913288 ], [ 10.449487503669586, 63.428076373147015 ], [ 10.449745129522436, 63.428176616095556 ], [ 10.449871034467826, 63.428254014455291 ], [ 10.450545177399064, 63.42854409825221 ], [ 10.45093532368565, 63.428694857463981 ], [ 10.451431560134035, 63.428905205406906 ], [ 10.451907019001826, 63.42916214655196 ], [ 10.452118235979498, 63.42936737853644 ], [ 10.452286520899733, 63.429507265739794 ], [ 10.452389029527833, 63.42961940310817 ], [ 10.451718294715979, 63.429778154018265 ], [ 10.451504572998783, 63.429866048264536 ], [ 10.451439027399806, 63.429937152937754 ], [ 10.451531921275388, 63.42999245249424 ], [ 10.451571263700183, 63.43006961820322 ], [ 10.451501534301382, 63.430163255843503 ], [ 10.451417564242522, 63.430201880171516 ], [ 10.451284773886773, 63.43022034108602 ], [ 10.451159174394208, 63.43021762273689 ], [ 10.451084255618358, 63.430202730844755 ], [ 10.451018236984959, 63.430176994743043 ], [ 10.450948236231067, 63.430164828766138 ], [ 10.450652586133028, 63.430256686162686 ], [ 10.450394072220467, 63.430389465602481 ], [ 10.450055358543452, 63.430532807283463 ], [ 10.449814044344691, 63.43078892201607 ], [ 10.449648755695335, 63.430977934318705 ], [ 10.449463581244444, 63.431318077243823 ], [ 10.449322487512964, 63.43148174888703 ], [ 10.449267601267643, 63.431610535762637 ], [ 10.449273702141317, 63.431651659082618 ], [ 10.449311610388342, 63.431722021772032 ], [ 10.44952974330447, 63.431879403431644 ], [ 10.449926761107365, 63.432294614405087 ], [ 10.450056690927605, 63.432460890292589 ], [ 10.450109911922583, 63.432513443969924 ], [ 10.450584801114493, 63.432977938679116 ], [ 10.45024937054043, 63.433726455086109 ], [ 10.451792904072351, 63.434114298206332 ], [ 10.452088594836999, 63.434189716613439 ], [ 10.452236081668957, 63.434234400243298 ], [ 10.45257248867695, 63.434339386430082 ], [ 10.45286459467143, 63.434402830264503 ], [ 10.45305602360737, 63.43443485960973 ], [ 10.453361637928062, 63.434511457464076 ], [ 10.453558163120068, 63.434583774611362 ], [ 10.453584990465574, 63.434586558850384 ], [ 10.453609350251218, 63.434579685751963 ], [ 10.454123903806403, 63.434280416987882 ], [ 10.454791037392622, 63.433900972935341 ], [ 10.455121032679401, 63.433600940923469 ] ] ] } }
]
}
*/


// Henteområde 17. mai 
/*
henteomr =  L.geoJson(henteomraade, {
		style: function(feature) {
         return {
			color: '#000', 
			fillColor: 'blue',
			weight: 4,
			opacity: .75,
			
		};
		}, 
			onEachFeature: function (feature, layer) {
				layer.bindPopup(feature.properties.description);
			}
			})	.addTo(map);


label = new L.Label( { opacity: 1, labelClassName: 'labelHentOmr' } )
label.setContent('<b>Henteområde<br>etter barnetoget</b>')
label.setLatLng(henteomr.getBounds().getCenter())
map.showLabel(label);
*/

// Deaktivert for 1. mai 
/*
marsjering =  L.geoJson(marsjgeo, {
		style: function(feature) {
         return {
			color: "#ff0000"
		};
		}, 
			onEachFeature: function (feature, layer) {
				layer.bindPopup(feature.properties.description);
			}
			}).addTo(map);

*/
			
			
	
viktigePunkt = L.geoJson(punkt, {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<b>' + feature.properties.name + '</b><br>' +  feature.properties.description);
			}, 
			pointToLayer: function (feature, latlng) {
				return L.circleMarker(latlng, {
					radius: 8,
					fillColor: "#ff7800",
					color: "#000",
					weight: 1,
					opacity: 1,
					fillOpacity: 0.8,
				});
			}
		}).addTo(map);			
			

var mylabels = L.geoJson(punkt, {
	onEachFeature: function (feature, layer) {
		layer.bindPopup('<b>' + feature.properties.name + '</b><br>' +  feature.properties.description);
	}, 
    pointToLayer: function(feature, ll) {
        return L.marker(ll, {
            icon: L.divIcon({
                className: 'mylabel',
                html: '<b>' + feature.properties.name + '</b>'
            })
        });
    }
}).addTo(map);

// 17. mai meny 
/* 
var layerControl = L.control.layers(null, { 
			"Oppmøtested" : viktigePunkt, 
			"Henteområde" : henteomr, 
			"Marsjruter":  marsjering, 
			"Navn oppmøtesteder": mylabels,
			"SSM fane": realtime, 
			"Spor etter SSM fane": realtimeLinje
			},  {position: 'bottomright'} ); 
map.addControl(layerControl);  
*/

 
// 1. mai meny
var layerControl = L.control.layers(null, {  
			"SSM fane": realtime, 
			"Spor etter SSM fane": realtimeLinje
			},  {position: 'bottomright'} ); 
map.addControl(layerControl); 


var firstTime = true; 

realtime.on('update', function(e) {
	
        popupContent = function(fId) {
            var feature = e.features[fId]; 
			var timestamp = new Date( Date.parse( feature.properties.time)); 
			var timePretty = mindato( timestamp ); 
			document.querySelector('#vegreferanse').innerHTML = "SSM fane " + timePretty['klokke'];
            return '<img src="img/ssmlogo36x55.jpg"><br>' + 
			feature.properties.id + ' var her<br>' + 
					'<b>' + timePretty['klokke'] + "</b><br>" + timePretty['dato'];
        },
        bindFeaturePopup = function(fId) {
            realtime.getLayer(fId).bindPopup(popupContent(fId)).openPopup();
        },
        updateFeaturePopup = function(fId) {
            realtime.getLayer(fId).getPopup().setContent(popupContent(fId));
        };

    Object.keys(e.enter).forEach(bindFeaturePopup);
    Object.keys(e.update).forEach(updateFeaturePopup);

	if (firstTime) {
		map.fitBounds(realtime.getBounds(), {maxZoom: 14});
	}
	
firstTime = false; 
	
	
});
