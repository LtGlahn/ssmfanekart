

var mindato = function( dateObj) { 

	var monthNames = [
			"jan", "feb", "mar",
			"apr", "mai", "juni", "juli",
			"aug", "sep", "okt",
			"nov", "des"
		];

		
	var datostreng = dateObj.getDate() + ". " 
						+ monthNames[dateObj.getMonth()] + " " 
						+  dateObj.getFullYear();

	var helTime = ('0'+dateObj.getHours()).slice(-2);
	var minutt = ('0'+dateObj.getMinutes()).slice(-2);
	var sekund = ('0'+dateObj.getSeconds()).slice(-2);

	var klokkestreng = helTime + ':' + minutt + ':' + sekund; 

	return { dato: datostreng, klokke: klokkestreng }; 

}



var map = new L.map('map').setView([63.43, 10.44], 14);

L.control.zoom( { position : 'bottomleft'} ).addTo(map) 

// L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
//     attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
// }).addTo(map);


L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>', 
	subdomains: 'abcd',
}).addTo(map);




function onLocationFound(e) {
	var radius = e.accuracy / 2;

	L.marker(e.latlng).addTo(map)
		.bindPopup("Du er her!");

	L.circle(e.latlng, radius).addTo(map)
		.bindPopup("Usikkerhet");
}

function onLocationError(e) {
	alert(e.message);
}

map.on('locationfound', onLocationFound);
map.on('locationerror', onLocationError);

/*
map.locate({setView: true, maxZoom: 13}); 
*/

realtime = L.realtime({
        url: 'https://jansimple.pythonanywhere.com/getfile/SSMfane.geojson',
        // url: 'https://jansimple.pythonanywhere.com/getfile/jan.geojson',
        crossOrigin: true,
        type: 'json'
    },
	{
        interval: 10 * 1000, 
		pointToLayer: function (feature, latlng) {
			return L.marker(latlng, {
				'icon': L.icon({
					iconUrl: 'img/1431044506_circle_red36x36.png',
					iconSize:     [36, 36], // size of the icon
					iconAnchor: [18, 18], 
					popupAnchor:  [0, -50] // point from which the popup should open relative to the iconAnchor
				})
			});
		}
	}).addTo(map); // KOMMENTER INN



realtimeLinje = L.realtime({
        url: 'https://jansimple.pythonanywhere.com/getfile/SSMfane_kurve.geojson',
        // url: 'https://jansimple.pythonanywhere.com/getfile/jan_kurve.geojson',
        crossOrigin: true,
        type: 'json'
    },
	{
        interval: 10 * 1000
    }).addTo(map); // KOMMENTER INN

var firstTimeLinje = true; 


	
realtimeLinje.on('update', function(e) {

	if (firstTimeLinje) {
	   popupContent = function(fId) {
				return 'Spor etter SSM fana'; 
			},
		bindFeaturePopup = function(fId) {
			realtimeLinje.getLayer(fId).bindPopup(popupContent(fId));
		},
		updateFeaturePopup = function(fId) {
            realtime.getLayer(fId).getPopup().setContent(popupContent(fId));
        };

		Object.keys(e.enter).forEach(bindFeaturePopup);
		Object.keys(e.update).forEach(updateFeaturePopup);
	}
	
	firstTimeLinje = false; 

});

// 1. mai punkt 
/*
var punkt = {"type": "FeatureCollection",
"features": [{ "type": "Feature", 
"properties": { "description": "Vi spiller  på Persaunet Helse- og Velferdssenter ca kl 10:00. Etterpå serverer de saft.", 
"name": "Persaunet Helse- og Velferdssenter" }, "geometry": { "type": "Point", "coordinates": [ 10.438772163518735, 63.428913977547886 ] } }, 

{"type":"Feature","geometry":{"type":"Point","coordinates":[10.455251,63.433514]},"properties":{"name":"Strindheim&nbsp;skole","description":"09:00 Oppmøte og avmarsj. Tilbake ca 11.00, uniformsinspeksjon, medalje- og stjernedryss og KAKER i festsalen"}}

]};
*/

/* Gamle 17. mai punkt 
{"type":"Feature","geometry":{"type":"Point","coordinates":[10.455691,63.428077]},"properties":{"name":"Bromstad&nbsp;h&vf.sent.","description":"Vi stopper på Bromstad Helse- og velferdssenter  for å spille litt"}},

{"type":"Feature","geometry":{"type":"Point","coordinates":[10.444608,63.4244]},"properties":{"name":"Valentinlyst&nbsp;16:00","description":"16:00 - oppmøte ALLE, P-plass ved Valentinlyst sykehjem. "}},

*/

// 17. mai punkt 2019
/*
 var punkt = {"type": "FeatureCollection", "features": [

	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.441668,63.425029]},"properties":{
		"name":"Valentinlyst helse- og velferdsenter",
		"description":"Start hovedprogram: Spilling Valentinlyst "}},


		{"type":"Feature","geometry":{"type":"Point","coordinates":[10.44365990, 63.42468991]},"properties":{
			"name":"10:15 Oppmøte Valentinlyst helse- og velferdsenter",
			"description":"Start hovedprogram 1030 med Spilling Valentinlyst helse- og velferdssenter"}},

			
		{"type":"Feature","geometry":{"type":"Point","coordinates":[10.43925580, 63.42868665]},"properties":{
				"name":"11:00 Persaunet Helse- og velferdssenter",
				"description":"1100 Minikonsert Persaunet Helse- og velferdssenter"}},
	


	{ "type": "Feature", "properties": { "name": "11:00 Minikonsert Persaunet H&Vf.sent.", 
											"description": "11:00 minikonsert Persaunet Helse- og Velferdssenter", 
											"geometry": { "type": "Point", "coordinates": [ 10.43918024, 63.42869692 ] } }},


	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.44909723, 63.42585899]},"properties":{
		"name":"12:00 Blålekeplassen Bromstadekra",
		"description":"Kl 12 spiller vi på blålekeplassen Bromstadekra / Tingsletta."}},

	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.44671009, 63.43112856]},"properties":{
		"name":"13:00 Persaunet leir","description":
		"1300 Minikonsert og avslutning på grusbane Persaunet Leir."}},

	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.45551410, 63.42822259]},"properties":{
		"name":"12:30 Bromstad sykehjem.",
		"description":"1230 Spilling Bromstad sykehjem"}},

	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.455251,63.433514]},"properties":{
		"name":"Strindheim&nbsp;skole",
		"description":"08:00 Flaggheis (signalkorps)"}}

//	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.41294,63.43262]},"properties":{"name":"Thornæsparken 09:15","description":"Avmarsj mot bispegata. HK og noe av AK (4. trinn og eldre) har marsjert hit, og slutter seg sammen med 2. og 3. trinn (buss) ca 0900."}},
//	{"type":"Feature","geometry":{"type":"Point","coordinates":[10.398731,63.427857]},"properties":{"name":"Bispegata","description":"Korpset marsjerer hit for å slutte seg til resten av barnetoget. Avmarsj 09:43"}},

	]} 





var henteomraade = {
"type": "FeatureCollection",
"name": "henteområde2018",
"features": [
{ "type": "Feature", "properties": { "cartodb_id": 1, "name": "Henteområde", "description": "Sånn cirka i dette området går toget i oppløsning -- det er her du må plukke opp ungene dine!", "created_at": "2015\/04\/29 22:01:42+00", "updated_at": "2015\/04\/29 22:12:28+00" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 10.401429514868269, 63.430351316564142 ], [ 10.400111587932804, 63.428524838690031 ], [ 10.400144274783944, 63.428451732186467 ], [ 10.400324052465219, 63.428418834199 ], [ 10.40040168373668, 63.428612566248127 ], [ 10.401020296589248, 63.429429207922368 ], [ 10.401050215850217, 63.429481444270316 ], [ 10.401173753443882, 63.429477990630424 ], [ 10.401214289216805, 63.429509936783617 ], [ 10.401480667153146, 63.42971370059837 ], [ 10.401584901997802, 63.429704634866219 ], [ 10.401893745981969, 63.430098344019711 ], [ 10.402029830362491, 63.430106977931764 ], [ 10.402220927577691, 63.430123382357493 ], [ 10.402298138573732, 63.430182956245602 ], [ 10.402348325721158, 63.430253754038546 ], [ 10.402288487199229, 63.430345272877524 ], [ 10.402186182629473, 63.430395349099648 ], [ 10.402027854580941, 63.43040361184309 ], [ 10.401880763750809, 63.430337820312083 ], [ 10.401704579041667, 63.430115611841202 ], [ 10.401476806603345, 63.429817308762026 ], [ 10.401306942412052, 63.429709383583415 ], [ 10.40116603234428, 63.429575555797399 ], [ 10.401084960798435, 63.429577282611525 ], [ 10.401653426756788, 63.430309874115977 ], [ 10.401969991840554, 63.430720842410274 ], [ 10.402386931219178, 63.431252674982517 ], [ 10.402958, 63.431791 ], [ 10.403205, 63.43217 ], [ 10.403452, 63.432588 ], [ 10.403735742553058, 63.432903578085472 ], [ 10.403694883989131, 63.432983982735713 ], [ 10.403555964871783, 63.433013220734402 ], [ 10.403466076031146, 63.432998601738795 ], [ 10.403392530616077, 63.432918197129567 ], [ 10.403044, 63.432477 ], [ 10.402604, 63.431945 ], [ 10.402052369719298, 63.431946014450951 ], [ 10.401431319547619, 63.43197159862828 ], [ 10.401553895239397, 63.432249368225982 ], [ 10.401619268941682, 63.43251617069874 ], [ 10.401848076899666, 63.432742768108028 ], [ 10.402183117123862, 63.432958399462379 ], [ 10.402395581656277, 63.43318133864782 ], [ 10.402387409943492, 63.433225195332575 ], [ 10.402264834251714, 63.433247123649764 ], [ 10.402125915134365, 63.433214231167689 ], [ 10.401880763750809, 63.43298763748718 ], [ 10.401504864962687, 63.432720839404809 ], [ 10.401325087281412, 63.43247596774539 ], [ 10.401300572143057, 63.432220129447757 ], [ 10.401177996451278, 63.431997182782759 ], [ 10.401128966174566, 63.431883881353748 ], [ 10.402420096794632, 63.431774234382928 ], [ 10.402078087235015, 63.431238861274345 ], [ 10.401591657959955, 63.430572341942053 ], [ 10.401429514868269, 63.430351316564142 ] ] ] ] } }
]
}
*/


/*
var henteomraade_2017 = {"type": "FeatureCollection", "features": [
	{"type":"Feature","geometry":{"type":"MultiPolygon","coordinates":[[[[10.40004,63.428514],[10.400142,63.428422],[10.400335,63.428437],[10.400442,63.428528],[10.400534,63.428691],[10.400909,63.429183],[10.401328,63.429656],[10.401607,63.430025],[10.401843,63.430496],[10.402519,63.431311],[10.402958,63.431791],[10.403205,63.43217],[10.403452,63.432588],[10.403624,63.432832],[10.403699,63.433015],[10.403398,63.432991],[10.403205,63.432856],[10.403044,63.432477],[10.402604,63.431945],[10.402014,63.431249],[10.401392,63.430553],[10.400952,63.429934],[10.400641,63.429445],[10.400426,63.429065],[10.400228,63.428806],[10.40004,63.428514]]]]},"properties":{"cartodb_id":1,"name":"Henteområde","description":"Sånn cirka i dette området går toget i oppløsning -- det er her du må plukke opp ungene dine!","created_at":"2015-04-29T22:01:42Z","updated_at":"2015-04-29T22:12:28Z"}}]}; 
*/
	
	


// Marsjruter for 17. mai - 2019
/*
var marsjgeo_fm = {
"type": "FeatureCollection",
"name": "marsjruter17mai2019",
"features": [
{ "type": "Feature", "properties": { "name": "SSM marsj formiddag", "description": "Marsjrute om formiddagen 17. Mai fra skolen til Thornæsparken." }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.455162082201088, 63.43361140563789 ], [ 10.454835205298913, 63.433918525651244 ], [ 10.455292781249998, 63.434252789247914 ], [ 10.455438384239125, 63.434590792528226 ], [ 10.455333439402169, 63.434700340333109 ], [ 10.454229698641305, 63.434880958679827 ], [ 10.454386, 63.435006 ], [ 10.454388, 63.435012 ], [ 10.454676479483695, 63.435220716177803 ], [ 10.454960698641303, 63.435437783004076 ], [ 10.454890712771739, 63.435463284642687 ], [ 10.454036, 63.435568 ], [ 10.453823, 63.435598 ], [ 10.453456534239129, 63.435639129129264 ], [ 10.453040979076125, 63.43569228149218 ], [ 10.452661, 63.435736 ], [ 10.451775616440218, 63.435841639432311 ], [ 10.451255445448368, 63.435903653063058 ], [ 10.450551650747281, 63.435957108876345 ], [ 10.45012765074728, 63.435980108876343 ], [ 10.449454684918475, 63.436021639452747 ], [ 10.448550540964673, 63.436092360489795 ], [ 10.448112383559783, 63.436122809583637 ], [ 10.447426, 63.436183 ], [ 10.446192835597827, 63.436300244921384 ], [ 10.445601767119568, 63.436353149749308 ], [ 10.444832075339674, 63.436420884551289 ], [ 10.443868, 63.436502 ], [ 10.443567616440216, 63.436527925108209 ], [ 10.443212198734889, 63.436558115883251 ], [ 10.442584, 63.43664 ], [ 10.442236232880434, 63.43669851010862 ], [ 10.441801541100544, 63.436764605218883 ], [ 10.440854411005434, 63.436914714715549 ], [ 10.440671757948436, 63.436972902439997 ], [ 10.440288, 63.43705 ], [ 10.440038579415818, 63.437102482411291 ], [ 10.439778, 63.43712 ], [ 10.439409418517151, 63.437139519930589 ], [ 10.439024335258154, 63.437148380254229 ], [ 10.438859, 63.437142 ], [ 10.43858, 63.437131 ], [ 10.437983863043479, 63.437101809863464 ], [ 10.43772284932065, 63.437056939620547 ], [ 10.437622239741847, 63.437006564870977 ], [ 10.43745, 63.436917 ], [ 10.43725, 63.436817 ], [ 10.437068, 63.436722 ], [ 10.436896698641302, 63.436622809726252 ], [ 10.436767952105978, 63.436551360339074 ], [ 10.436411746535327, 63.436447714514443 ], [ 10.436288815149457, 63.436422890814761 ], [ 10.435734657472826, 63.43636441497511 ], [ 10.43526590407609, 63.436314979689932 ], [ 10.435021828736414, 63.436353380709448 ], [ 10.43474, 63.436337 ], [ 10.433789, 63.436284 ], [ 10.433247, 63.436258 ], [ 10.432197, 63.4362 ], [ 10.431383356249999, 63.436156639535156 ], [ 10.431205301494565, 63.436156408444035 ], [ 10.430869541100545, 63.436182 ], [ 10.430651780842389, 63.436057074844122 ], [ 10.430337335529892, 63.435907591866368 ], [ 10.430259520516303, 63.435926374158214 ], [ 10.430047815013589, 63.435993136013067 ], [ 10.429514924524458, 63.43604997962484 ], [ 10.428379157540761, 63.435998061174082 ], [ 10.427335650611413, 63.435948251685055 ], [ 10.425435978872287, 63.435855639437264 ], [ 10.425359287635867, 63.435693387480818 ], [ 10.424700541372282, 63.43560855838971 ], [ 10.424185212432064, 63.4355527418356 ], [ 10.423957630163043, 63.435519197850738 ], [ 10.424046102785329, 63.43492693021895 ], [ 10.422148, 63.434912 ], [ 10.422022, 63.434916 ], [ 10.421816794565217, 63.434942605702169 ], [ 10.421620931521739, 63.43492309538113 ], [ 10.42136522601902, 63.434921286144288 ], [ 10.421156527377716, 63.434918721748474 ], [ 10.420935630163042, 63.434900394288924 ], [ 10.420421, 63.434914 ], [ 10.419522602717393, 63.434943523118982 ], [ 10.417518369836957, 63.434073459940556 ], [ 10.416533904076086, 63.434549414938012 ], [ 10.415153794429349, 63.433980492697188 ], [ 10.413402554823371, 63.433261053500772 ], [ 10.412273219157608, 63.432834340388482 ] ] ] } },
{ "type": "Feature", "properties": { "name": "SSM marsj formiddag #2", "description": "Marsjrute formiddag 17. Mai fra Thornæsparken til Bispegata" }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.412237339028533, 63.432817994497981 ], [ 10.411985821875001, 63.432714492135503 ], [ 10.411041787567934, 63.432356499993617 ], [ 10.410399068478261, 63.432092776684087 ], [ 10.409952856453801, 63.431892247899128 ], [ 10.409242570637604, 63.431612646089604 ], [ 10.408641296807192, 63.431347528278941 ], [ 10.407725493206524, 63.430957129781341 ], [ 10.407255602717392, 63.430766340556914 ], [ 10.407141588994566, 63.430666318869527 ], [ 10.406982260190217, 63.430574615993173 ], [ 10.40685906847826, 63.430431807956609 ], [ 10.406742506793481, 63.430336402024743 ], [ 10.406008383559781, 63.430341720855075 ], [ 10.405925643885872, 63.430291681192131 ], [ 10.40539839728261, 63.429992489069569 ], [ 10.404924424728261, 63.429762236079917 ], [ 10.404128657744565, 63.42946622575343 ], [ 10.403970296909099, 63.429465696885863 ], [ 10.403752759071049, 63.429189615642734 ], [ 10.403495626286878, 63.428976172761793 ], [ 10.403362820620645, 63.428891913761795 ], [ 10.403191616440216, 63.428755095735646 ], [ 10.402953, 63.428072 ], [ 10.400567547282607, 63.428328311938756 ], [ 10.400098095923914, 63.428408259384284 ], [ 10.399997, 63.428329845354114 ], [ 10.399883931521739, 63.428005793330655 ], [ 10.399791767255435, 63.42793964540197 ], [ 10.399689675547341, 63.427918122348984 ], [ 10.398825150679349, 63.427863363177551 ] ] ] } },
{ "type": "Feature", "properties": { "name": "Barnetog sentrum", "description": "Marsjrute barnetog i sentrum. Bispegt – Munkegt – Olav Trygvassons gt - Nordre gt - Kongens gt – Kjøpmanns gate " }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.398722616440217, 63.42785536318118 ], [ 10.396566616440214, 63.427705295969702 ], [ 10.395904910508952, 63.428928734024879 ], [ 10.396725666345255, 63.428907870517236 ], [ 10.398118920065546, 63.428862105350468 ], [ 10.39877642749078, 63.428847298957322 ], [ 10.398847895689171, 63.429321099742928 ], [ 10.398914097809788, 63.429716825076731 ], [ 10.399037474489122, 63.430351454805681 ], [ 10.397775120416423, 63.430398563557056 ], [ 10.397756012909857, 63.430530897456869 ], [ 10.397596302959441, 63.431524331936991 ], [ 10.397539661639819, 63.431937352743233 ], [ 10.397477449042844, 63.432303439246631 ], [ 10.3973883086054, 63.432858270452911 ], [ 10.397317739092426, 63.433265250584299 ], [ 10.398851697453411, 63.433295150937404 ], [ 10.400209232031955, 63.433323390131136 ], [ 10.400201803662169, 63.432534343359343 ], [ 10.400186946922593, 63.43192634723421 ], [ 10.400171161636807, 63.431517063888315 ], [ 10.400160019082128, 63.43123963664182 ], [ 10.40014609088878, 63.430966359871618 ], [ 10.400125662871867, 63.430790265263013 ], [ 10.400095020846495, 63.430560177728552 ], [ 10.400059736090006, 63.430315136636779 ], [ 10.401462643885871, 63.430264192094413 ] ] ] } },
{ "type": "Feature", "id": 0, "properties": { "name": "SSM marsj morgen", "description": "SSM marsjrute morgen 17.Mai" }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.441114076721204, 63.424792778143733 ], [ 10.441302308454619, 63.425218271830232 ], [ 10.44314498837052, 63.425117751349298 ], [ 10.445792089264611, 63.426298597485292 ], [ 10.446501095385123, 63.426601994353788 ], [ 10.446866544324834, 63.426439621548731 ], [ 10.447252555777141, 63.426636954581809 ], [ 10.448000878110435, 63.426962915177434 ], [ 10.448000878110435, 63.426962915177434 ], [ 10.448616720783704, 63.427238403927149 ], [ 10.44886913145937, 63.42735949429612 ], [ 10.44918047486528, 63.42751275288326 ], [ 10.449252435534001, 63.427932077806737 ], [ 10.449333476575161, 63.42800515913288 ], [ 10.449487503669586, 63.428076373147015 ], [ 10.449745129522436, 63.428176616095556 ], [ 10.449871034467826, 63.428254014455291 ], [ 10.450545177399064, 63.42854409825221 ], [ 10.45093532368565, 63.428694857463981 ], [ 10.451431560134035, 63.428905205406906 ], [ 10.451907019001826, 63.42916214655196 ], [ 10.452118235979498, 63.42936737853644 ], [ 10.452245463971732, 63.429491647569023 ], [ 10.452240464526616, 63.429541963053538 ], [ 10.452272960919869, 63.429601223399793 ], [ 10.451718294715979, 63.429778154018265 ], [ 10.451504572998783, 63.429866048264536 ], [ 10.451439027399806, 63.429937152937754 ], [ 10.451531921275388, 63.42999245249424 ], [ 10.451571263700183, 63.43006961820322 ], [ 10.451501534301382, 63.430163255843503 ], [ 10.451417564242522, 63.430201880171516 ], [ 10.451284773886773, 63.43022034108602 ], [ 10.451159174394208, 63.43021762273689 ], [ 10.451084255618358, 63.430202730844755 ], [ 10.451018236984959, 63.430176994743043 ], [ 10.450948236231067, 63.430164828766138 ], [ 10.450652586133028, 63.430256686162686 ], [ 10.450394072220467, 63.430389465602481 ], [ 10.450055358543452, 63.430532807283463 ], [ 10.449814044344691, 63.43078892201607 ], [ 10.449648755695335, 63.430977934318705 ], [ 10.449463581244444, 63.431318077243823 ], [ 10.449322487512964, 63.43148174888703 ], [ 10.449267601267643, 63.431610535762637 ], [ 10.449273702141317, 63.431651659082618 ], [ 10.449311610388342, 63.431722021772032 ], [ 10.44952974330447, 63.431879403431644 ], [ 10.449926761107365, 63.432294614405087 ], [ 10.450056690927605, 63.432460890292589 ], [ 10.450109911922583, 63.432513443969924 ], [ 10.450584801114493, 63.432977938679116 ], [ 10.45024937054043, 63.433726455086109 ], [ 10.451792904072351, 63.434114298206332 ], [ 10.452088594836999, 63.434189716613439 ], [ 10.452236081668957, 63.434234400243298 ], [ 10.45257248867695, 63.434339386430082 ], [ 10.45286459467143, 63.434402830264503 ], [ 10.45305602360737, 63.43443485960973 ], [ 10.453361637928062, 63.434511457464076 ], [ 10.453558163120068, 63.434583774611362 ], [ 10.453584990465574, 63.434586558850384 ], [ 10.453609350251218, 63.434579685751963 ], [ 10.454123903806403, 63.434280416987882 ], [ 10.454791037392622, 63.433900972935341 ], [ 10.455121032679401, 63.433600940923469 ] ] ] } }
]
}

var marsjgeo_em = {
"type": "FeatureCollection",
"name": "marsjruter17mai2019em",
"features": [
{ "type": "Feature", "properties": { "name": "Marsjrute em 17. Mai", "description": "Marsrute ettermiddag 17. Mai. Vi starter med spilling på Persaunet Helse- og Velferdssenter, dernest til Valentinlyst H&Vf, og til sist Bromstad H&Vf før vi marsjerer til skolegårdsfest" }, "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 10.439486880036188, 63.428653602230881 ], [ 10.439414388082009, 63.428722927791803 ], [ 10.439286902231556, 63.428758708660837 ], [ 10.439161916103661, 63.428751999751292 ], [ 10.439066926646461, 63.428710628107744 ], [ 10.439029430808093, 63.428648011452523 ], [ 10.439054428033671, 63.428586512818697 ], [ 10.439109421929945, 63.428550731734632 ], [ 10.439229408612725, 63.428507123478035 ], [ 10.439380016896839, 63.42850768255866 ], [ 10.439480005799156, 63.428471901376177 ], [ 10.439582494424029, 63.42844841995089 ], [ 10.439739976945175, 63.428439474640953 ], [ 10.440158680473626, 63.428478610351306 ], [ 10.440371156891045, 63.428508800719896 ], [ 10.440687996725263, 63.428523336811949 ], [ 10.440932969535936, 63.428513273364395 ], [ 10.441232936242884, 63.428446183623663 ], [ 10.442087216427046, 63.428270072306937 ], [ 10.442912749801797, 63.428128623386279 ], [ 10.443687663794746, 63.427969841947906 ], [ 10.443037700631322, 63.427645750457955 ], [ 10.442488134006451, 63.427272603617013 ], [ 10.44209558641726, 63.426996032823276 ], [ 10.441781548345904, 63.426671168482038 ], [ 10.441457696584822, 63.42627605823904 ], [ 10.441212354341575, 63.425959966122541 ], [ 10.440854154666438, 63.425286063651455 ], [ 10.441359559687523, 63.425218013986907 ], [ 10.442115213796718, 63.425160939950096 ], [ 10.443175092287539, 63.425090694825705 ], [ 10.44370503153295, 63.425035815702465 ], [ 10.444004349069713, 63.424976546131347 ], [ 10.444112299656741, 63.424912886085089 ], [ 10.444176088639981, 63.424833859624073 ], [ 10.444185902329712, 63.424746052189597 ], [ 10.444131927036201, 63.42460995013451 ], [ 10.44407304489782, 63.424524337220333 ], [ 10.444328200830798, 63.424493604316957 ], [ 10.444406710348634, 63.424469457012613 ], [ 10.444436151417825, 63.424405795840045 ], [ 10.444421430883226, 63.424335548864811 ], [ 10.444352735055123, 63.424287253969467 ], [ 10.444190809174581, 63.424249935130966 ], [ 10.443871864258361, 63.424285058745021 ], [ 10.443690310998356, 63.423942601671939 ], [ 10.443700124688087, 63.423892110859931 ], [ 10.443925839551875, 63.423808691062597 ], [ 10.444382176124313, 63.423644046013258 ], [ 10.445083854939998, 63.423705513608979 ], [ 10.445613794185411, 63.423955773173496 ], [ 10.44591801856704, 63.424130294997589 ], [ 10.446016155464337, 63.424391526937136 ], [ 10.446099571827041, 63.424516653997578 ], [ 10.446452864657317, 63.424676903645597 ], [ 10.446511746795695, 63.42470763635243 ], [ 10.446591483024749, 63.424704343563974 ], [ 10.446663858986508, 63.424712026736422 ], [ 10.446736234948263, 63.42473397864633 ], [ 10.44677303628475, 63.424760320916 ], [ 10.446809837621236, 63.424798736682568 ], [ 10.446807384198806, 63.424827274075831 ], [ 10.44676322259502, 63.424863494572506 ], [ 10.446792663664208, 63.424878860829985 ], [ 10.446861359492319, 63.424881056008957 ], [ 10.447302975530162, 63.424867884932617 ], [ 10.4477666723699, 63.424861299392184 ], [ 10.448460990918287, 63.424857457826235 ], [ 10.449079253371268, 63.424853067464504 ], [ 10.4497465842729, 63.424853067464504 ], [ 10.450347672768853, 63.424850872283393 ], [ 10.450956121532103, 63.424848677102112 ], [ 10.451446806018597, 63.424949655267 ], [ 10.452295690180231, 63.425393076910034 ], [ 10.452629355631045, 63.425489662892659 ], [ 10.454170104918633, 63.425805760196283 ], [ 10.454435074541342, 63.425941856572784 ], [ 10.454150477539175, 63.426604768391435 ], [ 10.453868333959441, 63.427061334501381 ], [ 10.453730942303222, 63.427311564764352 ], [ 10.453608271181601, 63.427553012946809 ], [ 10.454035166684848, 63.42779006918316 ], [ 10.454420847527745, 63.428000591943032 ], [ 10.454660820893302, 63.428130300650288 ], [ 10.454800805356545, 63.428268954136385 ], [ 10.455368581732664, 63.428211172269954 ], [ 10.45484080091747, 63.42832933528355 ], [ 10.45490079425886, 63.428532841175844 ], [ 10.454967467209187, 63.42867352538422 ], [ 10.455134299934594, 63.428710838462798 ], [ 10.455286412125405, 63.428728397541796 ], [ 10.45534038741892, 63.428774490072954 ], [ 10.455350201108651, 63.428807413264117 ], [ 10.454937040235947, 63.428927549033816 ], [ 10.454705252698014, 63.429014265345778 ], [ 10.454542084071802, 63.429100860964766 ], [ 10.454450712202965, 63.429183634201124 ], [ 10.454332107376938, 63.429333432747562 ], [ 10.454350560901851, 63.429471102142237 ], [ 10.454493638342212, 63.429876921800115 ], [ 10.45455441229022, 63.430059958448922 ], [ 10.454625315229586, 63.430069019638765 ], [ 10.454698243967208, 63.430075362468671 ], [ 10.454767121108294, 63.430094390955148 ], [ 10.454803170562846, 63.430124644938999 ], [ 10.454806915609684, 63.430169562457039 ], [ 10.454791865985451, 63.430203634721067 ], [ 10.454695137319185, 63.430250509308884 ], [ 10.454825168708103, 63.430579722559834 ], [ 10.454928212450266, 63.430829922100862 ], [ 10.45528150528054, 63.43164195819044 ], [ 10.455448338005947, 63.431993101804203 ], [ 10.455644611800546, 63.432489084826351 ], [ 10.455703493938925, 63.432938973504228 ], [ 10.454496410102152, 63.433083814209404 ], [ 10.454673056517288, 63.433360326249613 ], [ 10.4544473416535, 63.43342177300724 ], [ 10.454790820794047, 63.433887008467195 ], [ 10.455134299934592, 63.433851896620588 ], [ 10.455067958831521, 63.433593913763126 ] ] ] } }
]
}
*/

var marsjgeo = {
	"type": "FeatureCollection",
	"name": "marsjruter1mai2021",
	"features": [
	{ "type": "Feature", "properties": { "name": "Marsjrute 1. Mai", "description": "Fra Strandveiparken via Trikkestallen, Rønningsbakke og Brian Smiths gate til Rønningen der vi spiller. Så til skolen via Tessems vei" }, "geometry": { "type": "LineString", "coordinates": [ [ 10.41744832342099, 63.436510568006291 ], [ 10.418189582537549, 63.43643105611423 ], [ 10.41980455007366, 63.437113594448611 ], [ 10.420229169473373, 63.436964103030448 ], [ 10.424717870285304, 63.437216784135472 ], [ 10.42836247104534, 63.438725454098176 ], [ 10.4292771, 63.4383033 ], [ 10.4332105, 63.4398624 ], [ 10.435938216117599, 63.437021377876817 ], [ 10.437537192340608, 63.437197544392539 ], [ 10.437676969088477, 63.437082395837166 ], [ 10.439244876015128, 63.437148808376207 ], [ 10.440169030093429, 63.437064152368649 ], [ 10.441783441794216, 63.436762301915174 ], [ 10.443202833455015, 63.436541201762729 ], [ 10.443155294569545, 63.436286860994748 ], [ 10.4422181244481, 63.435995962567368 ], [ 10.44237762068377, 63.435528030519698 ], [ 10.442941800697847, 63.435111077714922 ], [ 10.443083195930955, 63.434756745646936 ], [ 10.442970053694038, 63.434399724743365 ], [ 10.442470392772506, 63.434106482070334 ], [ 10.44200273712705, 63.434069801459913 ], [ 10.441437624832346, 63.434187681918253 ], [ 10.442225465940727, 63.434501004433614 ], [ 10.442286834754036, 63.434878121316657 ], [ 10.441964040747179, 63.434541590481388 ], [ 10.441515349758404, 63.434462017465997 ], [ 10.441161537482504, 63.434244109413648 ], [ 10.441600668481152, 63.434078710343371 ], [ 10.442022568386379, 63.434021501122835 ], [ 10.442463480608586, 63.434073638996495 ], [ 10.443489102284371, 63.433274512051511 ], [ 10.4446373, 63.4325442 ], [ 10.446444972475389, 63.433162231080701 ], [ 10.447143670749533, 63.432814799952801 ], [ 10.448891094239348, 63.433392481619883 ], [ 10.450804153031807, 63.43380687130378 ], [ 10.452466220477403, 63.434273045295882 ], [ 10.453581203487161, 63.434591286802544 ], [ 10.4551455, 63.4336658 ] ] } }
	]
}
	


// Henteområde 17. mai 
/*
henteomr =  L.geoJson(henteomraade, {
		style: function(feature) {
         return {
			color: '#000', 
			fillColor: 'blue',
			weight: 4,
			opacity: .75,
			
		};
		}, 
			onEachFeature: function (feature, layer) {
				layer.bindPopup(feature.properties.description);
			}
			})	.addTo(map);


label = new L.Label( { opacity: 1, labelClassName: 'labelHentOmr' } )
label.setContent('<b>Henteområde<br>etter barnetoget</b>')
label.setLatLng(henteomr.getBounds().getCenter())
map.showLabel(label);

*/

/* Kommenterer ut planlagte marsjruter
marsjering_fm =  L.geoJson(marsjgeo_fm, {
		style: function(feature) {
         return {
			color: "#ff0000"
		};
		}, 
			onEachFeature: function (feature, layer) {
				layer.bindPopup(feature.properties.description);
			}
			}).addTo(map);
			

marsjering_em =  L.geoJson(marsjgeo_em, {
		style: function(feature) {
         return {
			color: "#ff0000"
		};
		}, 
			onEachFeature: function (feature, layer) {
				layer.bindPopup(feature.properties.description);
			}
			}).addTo(map);
			
*/

marsjering =  L.geoJson(marsjgeo, {
	style: function(feature) {
	 return {
		color: "#ff0000"
	};
	}, 
		onEachFeature: function (feature, layer) {
			layer.bindPopup(feature.properties.description);
		}
		}).addTo(map);
			
/* DISSE TRENGER VI

viktigePunkt = L.geoJson(punkt, {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<b>' + feature.properties.name + '</b><br>' +  feature.properties.description);
			}, 
			pointToLayer: function (feature, latlng) {
				return L.circleMarker(latlng, {
					radius: 8,
					fillColor: "#ff7800",
					color: "#000",
					weight: 1,
					opacity: 1,
					fillOpacity: 0.8,
				});
			}
		}).addTo(map);			
			

var mylabels = L.geoJson(punkt, {
	onEachFeature: function (feature, layer) {
		layer.bindPopup('<b>' + feature.properties.name + '</b><br>' +  feature.properties.description);
	}, 
    pointToLayer: function(feature, ll) {
        return L.marker(ll, {
            icon: L.divIcon({
                className: 'mylabel',
                html: '<b>' + feature.properties.name + '</b>'
            })
        });
    }
}).addTo(map);



// 17. mai meny 

var layerControl = L.control.layers(null, { 
			"Oppmøtested" : viktigePunkt, 
//			"Henteområde" : henteomr, 
//			"Marsjruter morgen":  marsjering_fm, 
//			"Marsjruter ettermiddag":  marsjering_em, 
			"Navn oppmøtesteder": mylabels,
			"SSM fane": realtime, 
			"Spor etter SSM fane": realtimeLinje
			},  {position: 'bottomright'} ); 
map.addControl(layerControl);  

*/
 
// 1. mai meny

var layerControl = L.control.layers(null, {  
			"SSM fane": realtime, 
			"Spor etter SSM fane": realtimeLinje, 
			"Planlagt rute" : marsjering
			},  {position: 'bottomright'} ); 
map.addControl(layerControl); 

var firstTime = true; 

realtime.on('update', function(e) {
	
        popupContent = function(fId) {
            var feature = e.features[fId]; 
			var timestamp = new Date( Date.parse( feature.properties.time)); 
			var timePretty = mindato( timestamp ); 
			document.querySelector('#vegreferanse').innerHTML = "SSM fane " + timePretty['klokke'];
            return '<img src="img/ssmlogo36x55.jpg"><br>' + 
			feature.properties.id + ' var her<br>' + 
					'<b>' + timePretty['klokke'] + "</b><br>" + timePretty['dato'];
        },
        bindFeaturePopup = function(fId) {
            realtime.getLayer(fId).bindPopup(popupContent(fId)).openPopup();
        },
        updateFeaturePopup = function(fId) {
            realtime.getLayer(fId).getPopup().setContent(popupContent(fId));
        };

    Object.keys(e.enter).forEach(bindFeaturePopup);
    Object.keys(e.update).forEach(updateFeaturePopup);

	if (firstTime) {
		map.fitBounds(realtime.getBounds(), {maxZoom: 14});
	}
	
firstTime = false; 
	
	
});
